<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grey Market - Profile ðŸš€</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      margin: 0;
      padding: 0;
      text-align: center;
      transition: all 0.3s ease;
      overflow: hidden; /* Prevent page movement */
    }
    header {
      padding: 1rem;
      position: relative;
    }
    header h1 {
      font-size: 2rem;
      margin: 0;
      color: orange;
    }
    .profile-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      width: 40px;
      height: 40px;
      background: orange;
      border-radius: 0 6px 6px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: bold;
      color: #111;
      cursor: grab;
      z-index: 1001;
      box-shadow: 0 0 10px rgba(255, 165, 0, 0.7);
    }
    .profile-btn:active { cursor: grabbing; }
    .profile-panel {
      position: fixed;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: #1c1c1c;
      transition: left 0.5s ease;
      z-index: 1000;
      padding: 2rem;
      box-sizing: border-box;
      overflow-y: auto;
    }
    .profile-panel.active { left: 0; }
    .profile-card {
      max-width: 500px;
      margin: 1rem auto;
      perspective: 1000px;
    }
    .card-inner {
      position: relative;
      width: 100%;
      padding: 1rem;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .profile-card:hover .card-inner, .profile-card.touched .card-inner {
      transform: rotateY(180deg);
    }
    .card-front, .card-back {
      backface-visibility: hidden;
      position: absolute;
      width: 100%;
      padding: 1rem;
      background: #222;
      border-radius: 8px;
      text-align: center;
    }
    .card-back {
      transform: rotateY(180deg);
    }
    .profile-panel input, .profile-panel textarea {
      width: 100%;
      max-width: 400px;
      padding: 0.5rem;
      margin: 0.5rem auto;
      border: none;
      border-radius: 6px;
      background: #333;
      color: #eee;
      display: block;
    }
    .profile-panel button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      background: orange;
      color: #111;
      font-weight: bold;
      cursor: pointer;
      margin: 0.5rem auto;
      display: block;
    }
    .profile-panel button:hover {
      background: #ffb84d;
    }
    .dashboard {
      max-width: 500px;
      margin: 1rem auto;
      text-align: center;
    }
    .dashboard h3 {
      color: orange;
    }
    .dashboard ul {
      list-style: none;
      padding: 0;
      max-width: 400px;
      margin: 0 auto;
    }
    .dashboard li {
      background: #333;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border-radius: 6px;
    }
    .theme-switcher {
      margin: 1rem auto;
      max-width: 400px;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }
    .theme-switcher button {
      width: 100px;
    }
    .neon { background-color: #0a1a2b; color: #00ffcc; }
    .neon .profile-panel { box-shadow: 0 0 20px rgba(0, 255, 204, 0.7); }
    .arcade { background-color: #1a0a2b; color: #ff00ff; font-family: 'Courier New', monospace; }
    .arcade .profile-panel { box-shadow: 0 0 20px rgba(255, 0, 255, 0.7); }
    @media (max-width: 600px) {
      .profile-panel { padding: 1rem; }
      .profile-card, .dashboard, .theme-switcher, input, textarea, button {
        max-width: 90%;
        margin-left: auto;
        margin-right: auto;
      }
      .card-front, .card-back { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Grey Market - Profile ðŸš€</h1>
  </header>
  <div class="profile-btn">â†”</div>
  <div class="profile-panel">
    <div class="profile-card">
      <div class="card-inner">
        <div class="card-front">
          <p>Reputation Score: <span id="rep-score">0</span>/100</p>
          <p>Sales: <span id="sales-count">0</span> | Purchases: <span id="purchase-count">0</span></p>
          <p>Badges: <span id="badges">None</span></p>
        </div>
        <div class="card-back">
          <p>Tap to flip back</p>
        </div>
      </div>
    </div>
    <h3 id="display-name">Loading...</h3>
    <p id="bio">Your bio goes here.</p>
    <input type="text" id="nickname" placeholder="Nickname (e.g., RizzMaster)">
    <textarea id="bio-input" placeholder="Your bio (e.g., Selling epic PES mods)"></textarea>
    <input type="text" id="avatar-url" placeholder="Avatar URL (e.g., Imgur link)">
    <div class="theme-switcher">
      <button onclick="setTheme('default')">Default Theme</button>
      <button onclick="setTheme('neon')">Neon Cyberpunk</button>
      <button onclick="setTheme('arcade')">Retro Arcade</button>
    </div>
    <button onclick="saveProfile()">Save Profile</button>
    <button id="upload-btn" style="display: none;" onclick="window.location.href='upload.html'">Upload Item</button>
    <div class="dashboard">
      <h3 id="dashboard-title">Dashboard</h3>
      <ul id="dashboard-list"></ul>
    </div>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user) {
      alert("Please log in to view your profile.");
      window.location.href = "index.html";
    } else {
      document.getElementById("display-name").textContent = user.nickname || user.displayName;
      document.getElementById("bio").textContent = user.bio || "Your bio goes here.";
      document.getElementById("rep-score").textContent = calculateRepScore();
      document.getElementById("sales-count").textContent = getSalesCount();
      document.getElementById("purchase-count").textContent = getPurchaseCount();
      document.getElementById("badges").textContent = getBadges();
      document.getElementById("dashboard-title").textContent = user.role === "seller" ? "Seller Dashboard" : "Buyer Dashboard";
      if (user.role === "seller") {
        document.getElementById("upload-btn").style.display = "block";
      }
      loadDashboard();
      applyTheme(user.theme || "default");
    }

    function calculateRepScore() {
      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
      const purchases = JSON.parse(localStorage.getItem("purchases") || "[]");
      return Math.min((uploads.length + purchases.length) * 10, 100);
    }

    function getSalesCount() {
      return JSON.parse(localStorage.getItem("uploads") || "[]").filter(u => u.status === "approved").length;
    }

    function getPurchaseCount() {
      return JSON.parse(localStorage.getItem("purchases") || "[]").length;
    }

    function getBadges() {
      const sales = getSalesCount();
      const purchases = getPurchaseCount();
      const badges = [];
      if (sales >= 1) badges.push("First Sale");
      if (purchases >= 1) badges.push("First Purchase");
      if (sales >= 5) badges.push("Top Seller");
      return badges.length ? badges.join(", ") : "None";
    }

    function loadDashboard() {
      const list = document.getElementById("dashboard-list");
      if (user.role === "seller") {
        const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
        list.innerHTML = uploads.map(u => `<li>${u.name} - $${u.price} (${u.status})</li>`).join("");
      } else {
        const purchases = JSON.parse(localStorage.getItem("purchases") || "[]");
        list.innerHTML = purchases.map(p => `<li>${p.name} - $${p.price} (Bought on ${p.date})</li>`).join("");
      }
    }

    function saveProfile() {
      const nickname = document.getElementById("nickname").value;
      const bio = document.getElementById("bio-input").value;
      const avatarUrl = document.getElementById("avatar-url").value;
      localStorage.setItem("user", JSON.stringify({
        ...user,
        nickname: nickname || user.nickname || user.displayName,
        bio: bio || user.bio,
        avatarUrl: avatarUrl || user.avatarUrl
      }));
      alert("Profile saved!");
      window.location.reload();
    }

    function setTheme(theme) {
      document.body.className = theme;
      localStorage.setItem("user", JSON.stringify({ ...user, theme }));
      applyTheme(theme);
    }

    function applyTheme(theme) {
      document.body.className = theme;
    }

    // Draggable profile button
    const btn = document.querySelector(".profile-btn");
    const panel = document.querySelector(".profile-panel");
    let isDragging = false;
    let startX;

    btn.addEventListener("mousedown", startDragging);
    btn.addEventListener("touchstart", startDragging);
    document.addEventListener("mousemove", drag);
    document.addEventListener("touchmove", drag);
    document.addEventListener("mouseup", stopDragging);
    document.addEventListener("touchend", stopDragging);

    function startDragging(e) {
      isDragging = true;
      startX = e.type.includes("touch") ? e.touches[0].clientX : e.clientX;
    }

    function drag(e) {
      if (!isDragging) return;
      const x = e.type.includes("touch") ? e.touches[0].clientX : e.clientX;
      if (x - startX > 50) {
        panel.classList.add("active");
      } else if (startX - x > 50) {
        panel.classList.remove("active");
      }
    }

    function stopDragging() {
      isDragging = false;
    }

    // Touch support for 3D card
    document.querySelector(".profile-card").addEventListener("touchstart", () => {
      document.querySelector(".profile-card").classList.toggle("touched");
    });
  </script>
</body>
</html>
