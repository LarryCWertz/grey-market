<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grey Market - Profile ðŸš€</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      margin: 0;
      padding: 0;
      text-align: center;
      overflow: hidden; /* Prevent page movement */
    }
    header {
      padding: 1rem;
      position: relative;
    }
    header h1 {
      font-size: 2rem;
      margin: 0;
      color: orange;
    }
    .profile-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      width: 40px;
      height: 40px;
      background: orange;
      border-radius: 0 6px 6px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: bold;
      color: #111;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 0 10px rgba(255, 165, 0, 0.7);
    }
    .profile-panel {
      position: fixed;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: #1c1c1c;
      transition: left 0.5s ease;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 2rem;
      box-sizing: border-box;
      overflow-y: auto;
    }
    .profile-panel.active { left: 0; }
    .stats-bar {
      margin: 1rem 0;
      background: #222;
      padding: 1rem;
      border-radius: 8px;
      width: 100%;
      max-width: 500px;
      text-align: center;
    }
    .profile-card {
      max-width: 500px;
      margin: 1rem auto;
      perspective: 1000px;
    }
    .card-inner {
      position: relative;
      width: 100%;
      padding: 1rem;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .profile-card:hover .card-inner, .profile-card.touched .card-inner {
      transform: rotateY(180deg);
    }
    .card-front, .card-back {
      backface-visibility: hidden;
      position: absolute;
      width: 100%;
      padding: 1rem;
      background: #222;
      border-radius: 8px;
      text-align: center;
    }
    .card-back { transform: rotateY(180deg); }
    .profile-panel input, .profile-panel textarea {
      width: 100%;
      max-width: 400px;
      padding: 0.5rem;
      margin: 0.5rem auto;
      border: none;
      border-radius: 6px;
      background: #333;
      color: #eee;
      display: block;
    }
    .profile-panel button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      background: orange;
      color: #111;
      font-weight: bold;
      cursor: pointer;
      margin: 0.5rem auto;
      display: block;
    }
    .profile-panel button:hover { background: #ffb84d; }
    .dashboard {
      max-width: 500px;
      margin: 1rem auto;
      text-align: center;
    }
    .dashboard h3 { color: orange; }
    .dashboard ul {
      list-style: none;
      padding: 0;
      max-width: 400px;
      margin: 0 auto;
    }
    .dashboard li {
      background: #333;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border-radius: 6px;
    }
    .theme-switcher, .avatar-picker {
      margin: 1rem auto;
      max-width: 400px;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .avatar-img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin: 0.5rem auto;
      display: block;
      object-fit: cover;
    }
    @media (max-width: 600px) {
      .profile-panel { padding: 1rem; }
      .profile-card, .dashboard, .theme-switcher, .avatar-picker, input, textarea, button {
        max-width: 90%;
        margin-left: auto;
        margin-right: auto;
      }
      .card-front, .card-back { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Grey Market - Profile ðŸš€</h1>
  </header>
  <div class="profile-btn">â†”</div>
  <div class="profile-panel">
    <img id="avatar-img" src="https://via.placeholder.com/100" alt="Profile Picture" class="avatar-img">
    <input type="file" id="avatar-upload" accept="image/*">
    <div class="avatar-picker">
      <button onclick="setAvatar('https://i.imgur.com/rizzpack.png')">Rizz Pack</button>
      <button onclick="setAvatar('https://i.imgur.com/gamepad.png')">Gamepad</button>
      <button onclick="setAvatar('https://i.imgur.com/python.png')">Python</button>
    </div><!-- Stats Bar moved above credentials -->
<div class="stats-bar">
  <p>Reputation Score: <span id="rep-score">0</span>/100</p>
  <p>Sales: <span id="sales-count">0</span> | Purchases: <span id="purchase-count">0</span></p>
  <p>Badges: <span id="badges">None</span></p>
</div>

<h3 id="display-name">Loading...</h3>
<p id="bio">Your bio goes here.</p>

<input type="text" id="nickname" placeholder="Nickname (e.g., RizzMaster)">
<textarea id="bio-input" placeholder="Your bio (e.g., Selling epic PES mods)"></textarea>

<div class="theme-switcher">
  <button onclick="setTheme('default')">Default Theme</button>
  <button onclick="setTheme('neon')">Neon Cyberpunk</button>
  <button onclick="setTheme('arcade')">Retro Arcade</button>
</div>
<button onclick="saveProfile()">Save Profile</button>
<button id="upload-btn" onclick="window.location.href='upload.html'">Upload Item</button>

<div class="dashboard">
  <h3 id="dashboard-title">Dashboard</h3>
  <ul id="dashboard-list"></ul>
</div>

  </div>  <script>
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user) {
      alert("Please log in to view your profile.");
      window.location.href = "index.html";
    } else {
      document.getElementById("avatar-img").src = user.avatarUrl || "https://via.placeholder.com/100";
      document.getElementById("display-name").textContent = user.nickname || user.displayName;
      document.getElementById("bio").textContent = user.bio || "Your bio goes here.";
      document.getElementById("rep-score").textContent = calculateRepScore();
      document.getElementById("sales-count").textContent = getSalesCount();
      document.getElementById("purchase-count").textContent = getPurchaseCount();
      document.getElementById("badges").textContent = getBadges();
      document.getElementById("dashboard-title").textContent = user.role === "seller" ? "Seller Dashboard" : "Buyer Dashboard";
      if (user.role !== "seller") {
        document.getElementById("upload-btn").style.display = "none";
      }
      loadDashboard();
      applyTheme(user.theme || "default");
    }

    function calculateRepScore() {
      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
      const purchases = JSON.parse(localStorage.getItem("purchases") || "[]");
      return Math.min((uploads.length + purchases.length) * 10, 100);
    }
    function getSalesCount() {
      return JSON.parse(localStorage.getItem("uploads") || "[]").filter(u => u.status === "approved").length;
    }
    function getPurchaseCount() {
      return JSON.parse(localStorage.getItem("purchases") || "[]").length;
    }
    function getBadges() {
      const sales = getSalesCount();
      const purchases = getPurchaseCount();
      const badges = [];
      if (sales >= 1) badges.push("First Sale");
      if (purchases >= 1) badges.push("First Purchase");
      if (sales >= 5) badges.push("Top Seller");
      return badges.length ? badges.join(", ") : "None";
    }
    function loadDashboard() {
      const list = document.getElementById("dashboard-list");
      if (user.role === "seller") {
        const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
        list.innerHTML = uploads.map(u => `<li>${u.name} - $${u.price} (${u.status})</li>`).join("");
      } else {
        const purchases = JSON.parse(localStorage.getItem("purchases") || "[]");
        list.innerHTML = purchases.map(p => `<li>${p.name} - $${p.price} (Bought on ${p.date})</li>`).join("");
      }
    }
    function saveProfile() {
      const nickname = document.getElementById("nickname").value;
      const bio = document.getElementById("bio-input").value;
      const avatarUrl = document.getElementById("avatar-img").src;
      localStorage.setItem("user", JSON.stringify({
        ...user,
        nickname: nickname || user.nickname || user.displayName,
        bio: bio || user.bio,
        avatarUrl: avatarUrl || user.avatarUrl
      }));
      alert("Profile saved!");
      window.location.reload();
    }
    function setTheme(theme) {
      document.body.className = theme;
      localStorage.setItem("user", JSON.stringify({ ...user, theme }));
      applyTheme(theme);
    }
    function applyTheme(theme) { document.body.className = theme; }
    function setAvatar(url) {
      document.getElementById("avatar-img").src = url;
      localStorage.setItem("user", JSON.stringify({ ...user, avatarUrl: url }));
      alert("Avatar updated!");
    }

    document.getElementById("avatar-upload").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const maxSize = 100;
            canvas.width = maxSize;
            canvas.height = maxSize;
            ctx.drawImage(img, 0, 0, maxSize, maxSize);
            const resizedUrl = canvas.toDataURL("image/jpeg", 0.7);
            document.getElementById("avatar-img").src = resizedUrl;
            localStorage.setItem("user", JSON.stringify({ ...user, avatarUrl: resizedUrl }));
            alert("Profile picture updated!");
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    const btn = document.querySelector(".profile-btn");
    const panel = document.querySelector(".profile-panel");
    btn.addEventListener("click", () => panel.classList.toggle("active"));
  </script></body>
</html>
